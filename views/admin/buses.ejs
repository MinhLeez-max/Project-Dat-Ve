<div class="container-fluid py-4">
  <div class="row">
    <div class="col-lg-2 mb-4">
      <!-- Admin Sidebar -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Admin Panel</h5>
        </div>
        <div class="list-group list-group-flush">
          <a href="/admin/dashboard" class="list-group-item list-group-item-action">
            <i class="fas fa-tachometer-alt me-2"></i> Dashboard
          </a>
          <a href="/admin/routes" class="list-group-item list-group-item-action">
            <i class="fas fa-route me-2"></i> Routes
          </a>
          <a href="/admin/buses" class="list-group-item list-group-item-action active">
            <i class="fas fa-bus me-2"></i> Buses
          </a>
          <a href="/admin/bookings" class="list-group-item list-group-item-action">
            <i class="fas fa-ticket-alt me-2"></i> Bookings
          </a>
          <a href="/" class="list-group-item list-group-item-action">
            <i class="fas fa-home me-2"></i> Back to Site
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-lg-10">
      <% if (locals.addBus) { %>
        <!-- Add Bus Form -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Add New Bus</h2>
          <a href="/admin/buses" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i> Back to Buses
          </a>
        </div>
        
        <div class="card">
          <div class="card-body">
            <form action="/admin/buses" method="POST" class="needs-validation" novalidate>
              <div class="mb-4">
                <h5>Basic Information</h5>
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="routeId" class="form-label">Route</label>
                    <select class="form-select" id="routeId" name="routeId" required>
                      <option value="">Select Route</option>
                      <% routes.forEach(route => { %>
                        <option value="<%= route._id %>">
                          <%= route.departureCity %> to <%= route.arrivalCity %>
                        </option>
                      <% }); %>
                    </select>
                    <div class="invalid-feedback">
                      Please select a route.
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="busNumber" class="form-label">Bus Number</label>
                    <input type="text" class="form-control" id="busNumber" name="busNumber" required>
                    <div class="invalid-feedback">
                      Please enter bus number.
                    </div>
                  </div>
                </div>
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="busName" class="form-label">Bus Name</label>
                    <input type="text" class="form-control" id="busName" name="busName" required>
                    <div class="invalid-feedback">
                      Please enter bus name.
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="busType" class="form-label">Bus Type</label>
                    <select class="form-select" id="busType" name="busType" required>
                      <option value="">Select Type</option>
                      <option value="Regular">Regular</option>
                      <option value="Sleeper">Sleeper</option>
                      <option value="AC">AC</option>
                      <option value="Deluxe">Deluxe</option>
                    </select>
                    <div class="invalid-feedback">
                      Please select bus type.
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mb-4">
                <h5>Schedule & Pricing</h5>
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="departureTime" class="form-label">Departure Time</label>
                    <input type="datetime-local" class="form-control" id="departureTime" name="departureTime" required>
                    <div class="invalid-feedback">
                      Please enter departure time.
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="arrivalTime" class="form-label">Arrival Time</label>
                    <input type="datetime-local" class="form-control" id="arrivalTime" name="arrivalTime" required>
                    <div class="invalid-feedback">
                      Please enter arrival time.
                    </div>
                  </div>
                </div>
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="price" class="form-label">Ticket Price (VND)</label>
                    <input type="number" class="form-control" id="price" name="price" min="1" required>
                    <div class="invalid-feedback">
                      Please enter a valid price.
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="totalSeats" class="form-label">Total Seats</label>
                    <input type="number" class="form-control" id="totalSeats" name="totalSeats" min="1" required>
                    <div class="invalid-feedback">
                      Please enter total seats.
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mb-4">
                <h5>Seat Layout</h5>
                <div class="row mb-3">
                  <div class="col-md-4">
                    <label for="rows" class="form-label">Number of Rows</label>
                    <input type="number" class="form-control" id="rows" name="rows" min="1" required>
                    <div class="invalid-feedback">
                      Please enter number of rows.
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="columns" class="form-label">Number of Columns</label>
                    <input type="number" class="form-control" id="columns" name="columns" min="1" required>
                    <div class="invalid-feedback">
                      Please enter number of columns.
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="layout" class="form-label">Layout Pattern</label>
                    <select class="form-select" id="layout" name="layout" required>
                      <option value="">Select Layout</option>
                      <option value="2-2">2-2 (4 seats per row with aisle)</option>
                      <option value="2-1">2-1 (3 seats per row with aisle)</option>
                      <option value="1-1">1-1 (2 seats per row with aisle)</option>
                      <option value="3-2">3-2 (5 seats per row with aisle)</option>
                    </select>
                    <div class="invalid-feedback">
                      Please select layout pattern.
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mb-4">
                <h5>Amenities</h5>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="wifi" name="wifi">
                  <label class="form-check-label" for="wifi">WiFi</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="usb" name="usb">
                  <label class="form-check-label" for="usb">USB Charging</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="food" name="food">
                  <label class="form-check-label" for="food">Food</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="waterBottle" name="waterBottle">
                  <label class="form-check-label" for="waterBottle">Water Bottle</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="blanket" name="blanket">
                  <label class="form-check-label" for="blanket">Blanket</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="entertainment" name="entertainment">
                  <label class="form-check-label" for="entertainment">Entertainment</label>
                </div>
              </div>
              
              <div class="text-end">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save me-1"></i> Save Bus
                </button>
              </div>
            </form>
          </div>
        </div>
      <% } else if (locals.editBus) { %>
        <!-- Edit Bus Form -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Edit Bus</h2>
          <a href="/admin/buses" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i> Back to Buses
          </a>
        </div>
        
        <div class="card">
          <div class="card-body">
            <form action="/admin/buses/<%= bus._id %>?_method=PUT" method="POST" class="needs-validation" novalidate>
              <div class="mb-4">
                <h5>Basic Information</h5>
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="routeId" class="form-label">Route</label>
                    <select class="form-select" id="routeId" name="routeId" required>
                      <option value="">Select Route</option>
                      <% routes.forEach(route => { %>
                        <option value="<%= route._id %>" <%= bus.routeId.toString() === route._id.toString() ? 'selected' : '' %>>
                          <%= route.departureCity %> to <%= route.arrivalCity %>
                        </option>
                      <% }); %>
                    </select>
                    <div class="invalid-feedback">
                      Please select a route.
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="busNumber" class="form-label">Bus Number</label>
                    <input type="text" class="form-control" id="busNumber" name="busNumber" value="<%= bus.busNumber %>" required>
                    <div class="invalid-feedback">
                      Please enter bus number.
                    </div>
                  </div>
                </div>
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="busName" class="form-label">Bus Name</label>
                    <input type="text" class="form-control" id="busName" name="busName" value="<%= bus.busName %>" required>
                    <div class="invalid-feedback">
                      Please enter bus name.
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="busType" class="form-label">Bus Type</label>
                    <select class="form-select" id="busType" name="busType" required>
                      <option value="">Select Type</option>
                      <option value="Regular" <%= bus.busType === 'Regular' ? 'selected' : '' %>>Regular</option>
                      <option value="Sleeper" <%= bus.busType === 'Sleeper' ? 'selected' : '' %>>Sleeper</option>
                      <option value="AC" <%= bus.busType === 'AC' ? 'selected' : '' %>>AC</option>
                      <option value="Deluxe" <%= bus.busType === 'Deluxe' ? 'selected' : '' %>>Deluxe</option>
                    </select>
                    <div class="invalid-feedback">
                      Please select bus type.
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mb-4">
                <h5>Schedule & Pricing</h5>
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="departureTime" class="form-label">Departure Time</label>
                    <input type="datetime-local" class="form-control" id="departureTime" name="departureTime" 
                           value="<%= new Date(bus.departureTime).toISOString().slice(0, 16) %>" required>
                    <div class="invalid-feedback">
                      Please enter departure time.
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="arrivalTime" class="form-label">Arrival Time</label>
                    <input type="datetime-local" class="form-control" id="arrivalTime" name="arrivalTime" 
                           value="<%= new Date(bus.arrivalTime).toISOString().slice(0, 16) %>" required>
                    <div class="invalid-feedback">
                      Please enter arrival time.
                    </div>
                  </div>
                </div>
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="price" class="form-label">Ticket Price (VND)</label>
                    <input type="number" class="form-control" id="price" name="price" value="<%= bus.price %>" min="1" required>
                    <div class="invalid-feedback">
                      Please enter a valid price.
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="totalSeats" class="form-label">Total Seats</label>
                    <input type="number" class="form-control" id="totalSeats" name="totalSeats" value="<%= bus.totalSeats %>" min="1" required>
                    <div class="invalid-feedback">
                      Please enter total seats.
                    </div>
                  </div>
                </div>
                
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" id="available" name="available" <%= bus.available ? 'checked' : '' %>>
                  <label class="form-check-label" for="available">
                    Bus Available for Booking
                  </label>
                </div>
              </div>
              
              <div class="mb-4">
                <h5>Seat Layout</h5>
                <div class="row mb-3">
                  <div class="col-md-4">
                    <label for="rows" class="form-label">Number of Rows</label>
                    <input type="number" class="form-control" id="rows" name="rows" value="<%= bus.seatLayout.rows %>" min="1" required>
                    <div class="invalid-feedback">
                      Please enter number of rows.
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="columns" class="form-label">Number of Columns</label>
                    <input type="number" class="form-control" id="columns" name="columns" value="<%= bus.seatLayout.columns %>" min="1" required>
                    <div class="invalid-feedback">
                      Please enter number of columns.
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="layout" class="form-label">Layout Pattern</label>
                    <select class="form-select" id="layout" name="layout" required>
                      <option value="">Select Layout</option>
                      <option value="2-2" <%= bus.seatLayout.layout === '2-2' ? 'selected' : '' %>>2-2 (4 seats per row with aisle)</option>
                      <option value="2-1" <%= bus.seatLayout.layout === '2-1' ? 'selected' : '' %>>2-1 (3 seats per row with aisle)</option>
                      <option value="1-1" <%= bus.seatLayout.layout === '1-1' ? 'selected' : '' %>>1-1 (2 seats per row with aisle)</option>
                      <option value="3-2" <%= bus.seatLayout.layout === '3-2' ? 'selected' : '' %>>3-2 (5 seats per row with aisle)</option>
                    </select>
                    <div class="invalid-feedback">
                      Please select layout pattern.
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mb-4">
                <h5>Amenities</h5>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="wifi" name="wifi" <%= bus.amenities.wifi ? 'checked' : '' %>>
                  <label class="form-check-label" for="wifi">WiFi</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="usb" name="usb" <%= bus.amenities.usb ? 'checked' : '' %>>
                  <label class="form-check-label" for="usb">USB Charging</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="food" name="food" <%= bus.amenities.food ? 'checked' : '' %>>
                  <label class="form-check-label" for="food">Food</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="waterBottle" name="waterBottle" <%= bus.amenities.waterBottle ? 'checked' : '' %>>
                  <label class="form-check-label" for="waterBottle">Water Bottle</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="blanket" name="blanket" <%= bus.amenities.blanket ? 'checked' : '' %>>
                  <label class="form-check-label" for="blanket">Blanket</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="entertainment" name="entertainment" <%= bus.amenities.entertainment ? 'checked' : '' %>>
                  <label class="form-check-label" for="entertainment">Entertainment</label>
                </div>
              </div>
              
              <div class="text-end">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save me-1"></i> Update Bus
                </button>
              </div>
            </form>
          </div>
        </div>
      <% } else { %>
        <!-- Buses List -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Manage Buses</h2>
          <a href="/admin/buses/add" class="btn btn-primary">
            <i class="fas fa-plus me-1"></i> Add New Bus
          </a>
        </div>
        
        <div class="card">
          <div class="card-body">
            <% if (buses.length === 0) { %>
              <div class="text-center py-4">
                <p class="mb-0">No buses found. Please add a new bus.</p>
              </div>
            <% } else { %>
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead>
                    <tr>
                      <th>Bus Number</th>
                      <th>Bus Name</th>
                      <th>Route</th>
                      <th>Type</th>
                      <th>Departure</th>
                      <th>Arrival</th>
                      <th>Price</th>
                      <th>Status</th>
                      <th class="text-end">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% buses.forEach(bus => { %>
                      <tr>
                        <td><%= bus.busNumber %></td>
                        <td><%= bus.busName %></td>
                        <td><%= bus.routeId.departureCity %> to <%= bus.routeId.arrivalCity %></td>
                        <td><%= bus.busType %></td>
                        <td><%= new Date(bus.departureTime).toLocaleString('en-US', { 
                          hour: '2-digit', 
                          minute: '2-digit',
                          year: 'numeric',
                          month: 'short',
                          day: 'numeric'
                        }) %></td>
                        <td><%= new Date(bus.arrivalTime).toLocaleString('en-US', { 
                          hour: '2-digit', 
                          minute: '2-digit',
                          year: 'numeric',
                          month: 'short',
                          day: 'numeric'
                        }) %></td>
                        <td><%= bus.price.toLocaleString() %> VND</td>
                        <td>
                          <span class="badge bg-<%= bus.available ? 'success' : 'danger' %>">
                            <%= bus.available ? 'Active' : 'Inactive' %>
                          </span>
                        </td>
                        <td class="text-end">
                          <a href="/admin/buses/<%= bus._id %>" class="btn btn-sm btn-outline-primary me-1">
                            <i class="fas fa-edit"></i>
                          </a>
                          <form action="/admin/buses/<%= bus._id %>?_method=DELETE" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this bus?')">
                              <i class="fas fa-trash"></i>
                            </button>
                          </form>
                        </td>
                      </tr>
                    <% }); %>
                  </tbody>
                </table>
              </div>
            <% } %>
          </div>
        </div>
      <% } %>
    </div>
  </div>
</div>
