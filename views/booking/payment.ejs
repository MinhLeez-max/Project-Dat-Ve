<div class="container py-4">
  <!-- Booking Steps -->
  <div class="booking-steps mb-4">
    <div class="booking-step completed">
      <i class="fas fa-chair"></i>
      <div>Chọn Chỗ Ngồi</div>
    </div>
    <div class="booking-step completed">
      <i class="fas fa-user"></i>
      <div>Chi Tiết</div>
    </div>
    <div class="booking-step active">
      <i class="fas fa-credit-card"></i>
      <div>Thanh Toán</div>
    </div>
    <div class="booking-step">
      <i class="fas fa-check-circle"></i>
      <div>Xác Nhận</div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8">
      <div class="card mb-4">
        <div class="card-header">
          <h4 class="mb-0">Thông tin thanh toán</h4>
        </div>
        <div class="card-body">
          <form id="paymentForm" action="/bookings/payment" method="POST" class="needs-validation" novalidate>
            <div class="mb-4">
              <h5>Chọn phương thức thanh toán</h5>
              <div class="row mt-3">
                <div class="col-md-3 mb-3">
                  <div class="form-check payment-method">
                    <input class="form-check-input" type="radio" name="paymentMethod" id="creditCard" value="credit_card" checked>
                    <label class="form-check-label" for="creditCard">
                      <i class="far fa-credit-card me-2"></i> Thẻ tín dụng
                    </label>
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <div class="form-check payment-method">
                    <input class="form-check-input" type="radio" name="paymentMethod" id="debitCard" value="debit_card">
                    <label class="form-check-label" for="debitCard">
                      <i class="fas fa-credit-card me-2"></i> Thẻ ghi nợ
                    </label>
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <div class="form-check payment-method">
                    <input class="form-check-input" type="radio" name="paymentMethod" id="banking" value="banking">
                    <label class="form-check-label" for="banking">
                      <i class="fas fa-university me-2"></i> Banking
                    </label>
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <div class="form-check payment-method">
                    <input class="form-check-input" type="radio" name="paymentMethod" id="eWallet" value="e-wallet">
                    <label class="form-check-label" for="eWallet">
                      <i class="fas fa-wallet me-2"></i> Ví Điện tử
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div id="credit_cardDetails" class="payment-details">
              <h5>Chi tiết thẻ tín dụng</h5>
              <div class="alert alert-info mb-4">
                <i class="fas fa-info-circle me-2"></i>
                Đây là một ứng dụng demo. Không có khoản thanh toán thực tế sẽ được xử lý.
              </div>
              <div class="mb-3">
                <label for="ccName" class="form-label">Tên Chủ Thẻ</label>
                <input type="text" class="form-control" id="ccName">
              </div>
              <div class="mb-3">
                <label for="ccNumber" class="form-label">Số Thẻ</label>
                <input type="text" class="form-control" id="ccNumber" placeholder="XXXX XXXX XXXX XXXX">
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="ccExpiry" class="form-label">Ngày Hết Hạn</label>
                  <input type="text" class="form-control" id="ccExpiry" placeholder="MM/YY">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="ccCVV" class="form-label">CVV</label>
                  <input type="text" class="form-control" id="ccCVV" placeholder="XXX">
                </div>
              </div>
            </div>

            <div id="debit_cardDetails" class="payment-details d-none">
              <h5>Debit Card Details</h5>
              <div class="alert alert-info mb-4">
                <i class="fas fa-info-circle me-2"></i>
                Đây là một ứng dụng demo. Không có khoản thanh toán thực tế sẽ được xử lý.
              </div>
              <div class="mb-3">
                <label for="dcName" class="form-label">Tên Chủ Thẻ</label>
                <input type="text" class="form-control" id="dcName">
              </div>
              <div class="mb-3">
                <label for="dcNumber" class="form-label">Số Thẻ</label>
                <input type="text" class="form-control" id="dcNumber" placeholder="XXXX XXXX XXXX XXXX">
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="dcExpiry" class="form-label">Ngày Hết Hạn</label>
                  <input type="text" class="form-control" id="dcExpiry" placeholder="MM/YY">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="dcCVV" class="form-label">CVV</label>
                  <input type="text" class="form-control" id="dcCVV" placeholder="XXX">
                </div>
              </div>
            </div>

            <div id="bankingDetails" class="payment-details d-none">
              <h5>Banking Details</h5>
              <div class="alert alert-info mb-4">
                <i class="fas fa-info-circle me-2"></i>
                Đây là một ứng dụng demo. Không có khoản thanh toán thực tế sẽ được xử lý.
              </div>
              <div class="mb-3">
                <label for="bankName" class="form-label">Bank Name</label>
                <select class="form-select" id="bankName">
                  <option value="">Select Bank</option>
                  <option value="vietcombank">Vietcombank</option>
                  <option value="techcombank">Techcombank</option>
                  <option value="vietinbank">Vietinbank</option>
                  <option value="bidv">BIDV</option>
                  <option value="tpbank">TPBank</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="accountNumber" class="form-label">Account Number</label>
                <input type="text" class="form-control" id="accountNumber">
              </div>
              <div class="mb-3">
                <label for="accountName" class="form-label">Account Holder Name</label>
                <input type="text" class="form-control" id="accountName">
              </div>
            </div>

            <div id="e-walletDetails" class="payment-details d-none">
              <h5>E-Wallet Details</h5>
              <div class="alert alert-info mb-4">
                <i class="fas fa-info-circle me-2"></i>
                Đây là một ứng dụng demo. Không có khoản thanh toán thực tế sẽ được xử lý.
              </div>
              <div class="mb-3">
                <label for="walletType" class="form-label">E-Wallet Provider</label>
                <select class="form-select" id="walletType">
                  <option value="">Select E-Wallet</option>
                  <option value="momo">MoMo</option>
                  <option value="zalopay">ZaloPay</option>
                  <option value="vnpay">VNPay</option>
                  <option value="shopeepay">ShopeePay</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="walletPhone" class="form-label">Phone Number</label>
                <input type="text" class="form-control" id="walletPhone" placeholder="Enter the phone number linked to your wallet">
              </div>
            </div>

            <div class="form-check mb-4">
              <input class="form-check-input" type="checkbox" id="agreeTerms" required>
              <label class="form-check-label" for="agreeTerms">
                Tôi đồng ý với <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Điều khoản và điều kiện</a>
              </label>
              <div class="invalid-feedback">
                You must agree to the terms and conditions.
              </div>
            </div>

            <div class="d-flex justify-content-between mt-4">
              <a href="javascript:history.back()" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i> Quay lại
              </a>
              <button type="submit" class="btn btn-primary">
                Thanh Toán Ngay Bây Giờ <i class="fas fa-arrow-right ms-1"></i>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card mb-4 position-sticky" style="top: 20px;">
        <div class="card-header">
          <h5 class="mb-0">Booking Summary</h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <h6>Chi tiết hành trình</h6>
            <p class="mb-1 small">
              <strong>TừTừ:</strong> <%= bookingData.bus.departureCity %>
            </p>
            <p class="mb-1 small">
              <strong>Đến:</strong> <%= bookingData.bus.arrivalCity %>
            </p>
            <p class="mb-1 small">
              <strong>Date:</strong> <%= new Date(bookingData.journeyDate).toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' }) %>
            </p>
            <p class="mb-1 small">
              <strong>Số Xe:</strong> <%= bookingData.bus.busName %> (<%= bookingData.bus.busNumber %>)
            </p>
            <p class="mb-1 small">
              <strong>Khởi Hành:</strong> <%= new Date(bookingData.bus.departureTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) %>
            </p>
            <p class="mb-0 small">
              <strong>Đến Nơi:</strong> <%= new Date(bookingData.bus.arrivalTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) %>
            </p>
          </div>
          <hr>
          <div class="mb-3">
            <h6>Passengers</h6>
            <span><%= bookingData.bus.fare ? bookingData.bus.fare.toLocaleString('vi-VN') : '0' %> VND</span>
          </div>
          <hr>
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-2">
              <span>Giá Ghế:</span>
              <span><%= bookingData.bus.fare.toLocaleString() %> VND</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Số lượng ghế:</span>
              <span><%= bookingData && bookingData.seats ? bookingData.seats.length : 0 %></span>
            </div>
            <div class="d-flex justify-content-between mb-0">
              <span>Service Fee:</span>
              <span>0 VND</span>
            </div>
          </div>
          <hr>
          <div class="d-flex justify-content-between fw-bold">
            <span>Tổng số tiền:</span>
            <span><%= bookingData.totalAmount.toLocaleString() %> VND</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Terms Modal -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="termsModalLabel">Điều khoản và điều kiện</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h6>1. Điều khoản đặt vé</h6>
        <p>Bằng cách đặt vé với chúng tôi, bạn đồng ý với các điều khoản và điều kiện này.
        </p>
        
        <h6>2. Thanh toán</h6>
        <p>Tất cả các khoản thanh toán được xử lý an toàn. Sau khi thanh toán được hoàn thành, một xác nhận sẽ được gửi đến email của bạn.</p>
        
        <h6>3. Chính sách hủy bỏ</h6>
        <p>Việc hủy bỏ ít nhất 24 giờ trước khi khởi hành sẽ được hoàn lại tiền đầy đủ. Việc hủy bỏ ít hơn 24 giờ trước khi khởi hành không đủ điều kiện để hoàn lại tiền.</p>
        
        <h6>4. Chính sách hoàn tiền</h6>
        <p>Hoàn lại tiền sẽ được xử lý trong vòng 7-14 ngày làm việc và sẽ được trả lại cho phương thức thanh toán ban đầu.</p>
        
        <h6>5. Nhận dạng</h6>
        <p>ành khách phải mang nhận dạng hợp lệ phù hợp với các chi tiết được cung cấp trong quá trình đặt phòng.</p>
        
        <h6>6. Chính sách hành lý</h6>
        <p>Mỗi hành khách được phép một mảnh hành lý lên đến 20kg và một túi mang theo.</p>
        
        <h6>7. Sửa đổi dịch vụ</h6>
        <p>Công ty có quyền sửa đổi các dịch vụ, tuyến đường hoặc lịch trình nếu cần thiết.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Tôi hiểu</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const paymentMethodInputs = document.querySelectorAll('input[name="paymentMethod"]');
    const paymentDetailsContainers = document.querySelectorAll('.payment-details');
    
    paymentMethodInputs.forEach(input => {
      input.addEventListener('change', function() {
        // Hide all payment detail containers
        paymentDetailsContainers.forEach(container => {
          container.classList.add('d-none');
        });
        
        // Show the selected payment method details
        const selectedMethod = this.value;
        const selectedContainer = document.getElementById(`${selectedMethod}Details`);
        
        if (selectedContainer) {
          selectedContainer.classList.remove('d-none');
        }
      });
    });
  });
</script>
